(function(){var e=[].indexOf||function(e){for(var i=0,t=this.length;t>i;i++)if(i in this&&this[i]===e)return i;return-1};define(["backbone","store","views/header"],function(i,t,r){"use strict";var n;return n=i.Router.extend({initialize:function(e){return this.el=e},routes:{"":"home",login:"login",logout:"logout",signup:"signup","password/reset/step1":"pswReset","user/login_by_api":"loginByApi",cargos:"cargos","cargos/new":"cargoAdd","cargo/:id/edit":"cargoEdit","cargo/:id/detail":"cargoDetail","cargo/detail":"cargoDetail",cars:"cars","cars/new":"carsNew","cars/:id/edit":"carsEdit","*path":"notFound"},anonymous:["notFound","login","signup","loginByApi","pswReset","home"],notFound:function(){var e;return e=this,require(["views/notfound"],function(i){return e.switchView(new i)})},before:function(){var i,r;if(alert(this.current_route()),r=this.current_route().route,!(e.call(this.anonymous,r)>=0)){if(i=this._current_user(),!i)return this.redirect("login"),!1;if(parseInt(i.age)<(new Date/1e3).toFixed()-86400*i.max_age_days)return t.remove("current_user"),this.redirect("login"),!1}},after:function(){return window.addRoute("/#"+i.history.fragment)},loginByApi:function(){var e;return e=this,require(["views/login_by_api"],function(i){return e.switchView(new i)})},login:function(){var e,i;return e=this,i=this._current_user(),i&&parseInt(i.age)>(new Date/1e3).toFixed()-86400*i.max_age_days?(e.redirect(""),!1):(t.remove("current_user"),require(["views/login"],function(i){return e.switchView(new i)}))},logout:function(){var e;return window.isie6&&t.clear(),e=new Date,e.setTime(e.getTime()-1e4),document.cookie="isLogin=a; expires="+e.toGMTString()+";path=/",this.redirect("login"),!1},signup:function(){var e,i,r;return r=this,e=new UserModel(this._current_user()),e.isGuest()&&(t.remove("current_user"),t.remove("mylist"),t.remove("pv_list"),t.remove("cg_list"),t.remove("pb_list"),i=new Date,i.setTime(i.getTime()-1e4),document.cookie="isLogin=a; expires="+i.toGMTString()+";path=/"),r._current_user()&&!e.isGuest()?(r.redirect(""),!1):require(["views/signup"],function(e){return r.switchView(new e),document.title="注册"})},home:function(){var e;return e=this,require(["views/index"],function(i){return e.switchView(new i),document.title="首页"})},switchView:function(e){var i,t,n;return i=this,null!=(t=this.view)&&t.remove(),this.view=e,null!=(n=this.header)&&n.remove(),this.el.html(e.el),this.header=new r,this.el.prepend(this.header.el)},hasChange:function(){var e;return e=this,function(i){var t,r,n;return this.cancelNavigate?(i.stopImmediatePropagation(),this.cancelNavigate=!1,void 0):(null!=(n=e.view)?n.dirty:void 0)&&(r=i.originalEvent.oldURL||window.oldURL,t=confirm("该页面内容未保存，是否离开?"),t===!1)?(i.stopImmediatePropagation(),this.cancelNavigate=!0,window.location.href=r):void 0}}})})}).call(this);