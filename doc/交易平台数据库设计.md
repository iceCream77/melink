交易平台数据库设计文档
==================

### 数据库表清单

|表名   |  说明
|------|--------------------------
|[users](#users)					|用户信息表
|[cargos](#cargos)				|货物信息表
|[cargos_way](#cargos_way)		|货物途经地表
|[cars](#cars)						|车辆信息表
|[trades](#trades)				|交易信息表
|[trades_log](#trades_log)		|交易状态变动表
|[accounts](#accounts)			|账户信息表
|[accounts_log](#accounts_log)	|账户变动记录表
|[calls](#calls)					|电话沟通记录表
|[login_log](#login_log)			|登录记录表
|[uploads](#uploads)				|上传附件信息表
|[voices](#voices)				|语音信息表



### 数据库表设计
#### 1. <b id="users">用户表 users</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|login_name|varchar(50)|Y|||登录名,全局唯一|
|user_name|varchar(50)||||用户名,用于显示与方便记忆用,只限于本应用中|
|checked|tinyint|||0|审核,0未审核,1已审核|
|status|tinyint|||1|访问状态,0无效,不允许访问,1有效|
|is_admin|tinyint|||0|1是管理员,0不是|
|login_time|datetime||||最近登录时间|
|login_IP|varchar(50)||||最近登录ip|
|login_count|int|||0|登录次数|
|reg_time|date||||注册本应用时间|
|memo|varchar(500)||||个人说明档|

#### 2. <b id="cargos">货源表 cargos</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|login_name|varchar(50)|Y|||冗余|
|user_id|int||||用户id|
|type|tinyint||||1,短驳,2中长途|
|origin|varchar(50)||||启运地|
|destination|varchar(50)||||抵达地|
|title|varchar(50)||||货物名称|
|amount|decimal(8,2)||||数量,吨|
|measure|tinyint||||计量单位,1吨,2立方,3件,4箱|
|departure|datetime||||启运时间|
|car_length|decimal(8,2)||||所需车长|
|model_2|varchar(50)||||所需车型|
|distance|decimal(8,2)||||参考距离,单位是km|
|carriage|decimal(8,2)||||运费,参数运费为实时计算,不记录|
|scope|tinyint|||1|可见范围,0指定车辆,1仅我的车可见,2所有车可见|
|sender_company|varchar(50)||||发货方公司|
|sender_name|varchar(50)||||发货方联系人|
|sender_number|varchar(50)||||发货方联系电话|
|receiver_company|varchar(50)||||收货方公司|
|receiver_name|varchar(50)||||收货方联系人|
|receiver_number|varchar(50)||||收货方联系电话|
|memo|varchar(500)||||备注|

#### 3. <b id="cargos_way">货源途经地表 cargos_way</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|cargo_id|int||||货源id|
|address|varchar(50)||||地址|
|lng|decimal(18,12)||||经度|
|lat|decimal(18,12)||||纬度|

#### 4. <b id="cars">车辆信息表 cars</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|locate_number|varchar(50)||||随车手机号|
|plate_number|varchar(50)||||车牌|
|driver_name|varchar(50)||||司机姓名|
|status|tinyint||||车辆状态,0勿扰,1空车,2半载,3满载|
|location|varchar(50)||||位置|
|lng|decimal(18,12)||||位置经度|
|lat|decimal(18,12)||||位置纬度|
|length|decimal(6,2)||||车长|
|width|decimal(6,2)||||车宽|
|tonnage|decimal(6,2)||||吨位|
|volume|decimal(6,2)||||体积|
|model_1|varchar(50)||||车型1,轮轴拖挂|
|model_2|varchar(50)||||车型2|
|model_3|varchar(50)||||车型3|
|model_4|varchar(50)||||车型4|
|original|varchar(50)||||原始地|
|memo|varchar(500)||||车辆说明|
|app_id_map|varchar(50)||||地图的app_id|
|app_id_push|varchar(50)||||推送的app_id|

#### 5. <b id="trades">交易信息表 trades</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|type|tinyint||||1:车找货,2:货找车|
|cargo_id|int||||货源id|
|car_id|int||||车辆id|
|cargo_user_id|int||||货源用户id|
|car_user_id|int||||车辆用户id|
|trade_time|datetime||||交易达成时间|
|status|tinyint|||10|交易状态,0已取消,10待启运,60已收货,70待支付,80已评价,99已完成|
|memo|varchar(500)||||备注|

#### 6. <b id="trades_log">交易状态变更表 trades_log</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|trade_id|int||||交易id|
|user_id|int||||接发变更的用户id,如果为空则为系统自动触发|
|from_status|tinyint||||起始交易状态|
|to_status|tinyint||||结束交易状态|
|change_time|datetime||||状态变更时间|
|memo|varchar(500)||||备注|

#### 7. <b id="accounts">账户信息表 accounts</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|login_name|varchar(50)|Y|||冗余|
|user_id|int||||用户id|
|create_time|datetime||||开户时间|
|balance|decimal(18,2)||||账户余额|
|status|tinyint||||状态,0停用,1正常|
|level|tinyint|||1|等级,1普通,2高级,3金卡白金黑金....,不同等级有不同的透支额度,扩展用|
|card_bank|varchar(100)||||开户银行|
|card_number|varchar(50)||||银行卡号|
|memo|varchar(500)||||备注|

#### 8. <b id="accounts_log">账户余额变动表 accounts_log</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|user_id|int||||用户id|
|account_id|int||||账户id|
|type|int||||变更类型,1开头为支出,2开头为收入,100支付运费,200充值...|
|from_account|int||||转出的来源账户|
|to_account|int||||转入的目标账户|
|change_time|datetime||||变动时间|
|amount|decimal(18,2)||||变动金额|
|memo|varchar(500)||||备注|


#### 9. <b id="calls">通话记录表</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|type|tinyint||||类型,1车找货,2货找车|
|from_user|int||||呼出用户id|
|to_user|int||||呼入用户id|
|from_number|int||||呼出电话号码|
|to_number|int||||呼入电话号码|
|cargo_id|int||||货源id|
|car_id|int||||车辆id|
|start_time|datetime||||开始时间|
|end_time|datetime||||结束时间|
|result|tinyint|||0|结果:0未达成交易,1达成交易|


#### 10. <b id="login_log">登录日志 login_log</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|login_name|varchar(50)||||登录名,全局唯一|
|user_id|int||||用户id|
|login_time|datetime||||最近登录时间|
|login_IP|varchar(50)||||最近登录ip|
|reg_time|date||||注册本应用时间|
|memo|varchar(500)||||备注|

#### 11. <b id="uploads">上传文件表 uploads</b>

|字段|类型(长度)|索引|可空|默认值|说明|
|---|----|----|----|----|----|
|id|int|PK|N|自增|id|
|user_id|int||||用户id|
|path|varchar(200)||||路径|
|file_name|varchar(50)||||文件名|
|file_type|varchar(50)||||文件分类,idcard:身份证,car:车身照等|
|file_size|int||||文件,字节,不考虑上G的文件,int类型足够使用|
|upload_time|datetime||||上传时间|
|status|tinyint||||状态,0未审核,1已审核|
|memo|varchar(500)||||备注|
