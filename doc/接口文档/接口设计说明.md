车货交易平台接口设计
====================

## 1.接口访问规范

1. 接口访问遵循 RESTful 规范
2. token在请求头中传递，除非特别注明，其它接口都必须传入token
3. 返回的数据采用json格式	
	
### 1.2 接口返回数据格式

#### 1.2.1. 请求失败

		{
			"result":0,
			"errors":{
				"code":"error_code", 
				"message":"错误信息"
			}
		}
			
#### 1.2.2. 请求成功
1. 不需要返回数据的
				
			{
				"result":1
			}	
				
2. 返回单条数据
		
			{
				"result":1,
				"data":{
					"key1":"value1",
					"key2":"value2",
					...
				}
				
			}

3. 返回多条数据
		
			{
				"result":1,
				"total":30,/记录数
				"page_no":1,//当前页码1开始
				"page_size":20,//每页记录数
				"data":[
					{
						"key1":"value1",
						"key2":"value2",
						...
					},
					{
						"key1":"value1",
						"key2":"value2",
						...
					},
					...
				]
			}

### 1.3 MeFP portal
	
	统一认证 MeFP portal开发完成,具体的接口参阅<统一认证接口文档.md>

#### 1.3.1 登录与访问本App 

	1. 前端输入用户密码
	2. 提交到本App的/users/login 接口
	3. /users/login 接口访问MeFP portal的用户认证接口,返回认证结果
	4. 认证通过后,根据login_name在本App的数据库表 users 中查找记录
	5. 生成token,作为/users/login接口的返回值.
	6. 前端获取 token,encodingURI编码后,记录在cookie中,设定过期时间
	7. 在访问本App的其它接口时,从cookie中获取token,decodingURI后添加到RequestHead中
		
#### 1.3.2 访问其它App

	1. 调用 MeFP portal 的/ auth/token 接口
	2. 认证通过后,会获取到其它App的token
	3. 前端获取 token,encodingURI编码后,记录在cookie中,设定过期时间
	4. 在访问其它App时,从cookie中获取token,decodingURI后添加到RequestHead中

### 2.编码规则

#### 2.1 接口返回错误代码 （未完成）

0. 系统级错误

错误代码	|错误信息
--------|---------
00000	|未定义的错误信息
00001	|接口内部错误
00010	|传入参数错误
00011	|传入参数错误
00012	|不可空的参数未赋值
00013	|参数数据类型错误或者超出允许的范围

1. users

错误代码	|错误信息
--------|---------
10000	|用户账户未激活
10001	|货主信息不完整
10002	|车主信息不完整
10003	|用户名或密码错误
10010	|上传文件失败
10011	|访问文件失败

2. cargos

错误代码	|错误信息
--------|---------
20000	|提交货单信息失败

3. cars

错误代码	|错误信息
--------|---------
30000	|获取车辆列表失败

4. MeFP登录
错误代码	|错误信息
--------|---------
40001	|用户名已经存在
40002	|验证码错误
40003	|用户名或密码错误
40004	|电话号码错误
40005	|用户名不存在
40006	|获取token失败

5. trades 通话记录，匹配记录，交易记录相关的错误在此定义
错误代码	|错误信息
--------|---------
50000	|交易失败
50001	|验证码错误
50002	|用户名或密码错误
50003	|电话号码错误


6. locations
错误代码	|错误信息
--------|---------
50001	|提交车辆位置失败

7. messsages
错误代码	|错误信息
--------|---------
60001	|短信发送失败
60002	|app推送信息失败
60003	|微信推送失败

8. accounts
错误代码	|错误信息
--------|---------
70000	|帐户已冻结
70001	|帐户余额不足
	
#### 2.2 车型

车型编码|车型名称
-------|-------
CM2_01|普通
CM2_02|平板
CM2_03|高低平板
CM2_04|厢式
CM2_05|封闭
CM2_06|开顶厢
CM2_07|罐式
CM2_08|集装厢
CM2_09|自卸
CM2_10|高栏
CM2_11|轴线板
CM2_12|满轮车
CM2_13|框架板
CM2_14|高低高板
CM2_15|抽拉板
CM2_16|簸箕板
CM2_17|超低板
CM2_18|笼子车
CM2_19|叶片车
CM2_81|冷藏车
CM2_82|保温车
CM2_99|其它

#### 2.3 货单状态

状态值|名称
-----|-------
0	|取消
10	|未成交
20	|待成交（车找货）
30	|待成交（货找车）
99	|已成交

#### 2.4 交易状态

-----|-------
0	|取消
10	|待装货
20	|装货中
30	|待卸货
40	|卸货中
50	|待收货
80	|支付
90	|评价
99	|完成


#### 2.5车辆状态

状态值|名称
-----|-------
100	|空车
200	|半载
300	|满载
999	|勿扰
		
### 3.接口清单

	参阅 《接口文档》中的相应文件


  

